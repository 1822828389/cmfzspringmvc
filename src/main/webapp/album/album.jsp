<%@ page language="java" contentType="text/html; charset=utf-8" isELIgnored="false" pageEncoding="utf-8" %><!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"><script type="text/javascript">    $(function () {        var toolbar = [{            iconCls: 'icon-edit',            text: "专辑详情",            handler: function () {                var row = $("#album").treegrid("getSelected")                if (row == null) {                    alert("请先选中行！！！")                } else {                    if (row.size == null) {                        $("#album_dialog").dialog("open")                        /*填充内容*/                        $("#album_ff").form("load", row);                        $("#img").prop("src", "http://localhost:9001/" + row.newname);                    } else {                        alert("请先选专辑！！！")                    }                }                //获取专辑            }        }, '-', {            iconCls: 'icon-help',            text: "添加专辑",            handler: function () {                        $("#album_add_dialog").dialog("open");                        //alert("aa");                        // $("#album").datagrid("reload");            }        }, '-', {            iconCls: 'icon-help',            text: "添加章节",            handler: function () {                var row = $("#album").treegrid("getSelected");                if (row == null) {                    alert("请先选中章节！！！")                } else {                    if (row.size == null) {                        $("#chapter_dialog").dialog("open");                        $("#music_id").textbox("setValue", row.id);                    } else {                        alert("请先选专辑！！！")                    }                }            }        }, '-', {            iconCls: 'icon-help',            text: "下载音频",            handler: function () {                var row = $("#album").treegrid("getSelected");                location.href = "${pageContext.request.contextPath}/music/down?url=" + row.url + "&name=" + row.path;                /*$.ajax({                    type:"post",                    url:"$ {pageContext.request.contextPath}/music/down",                    data:"url="+row.url+"&name="+row.path,                    success:function () {                        alert("恭喜您！下载成功！")                    }                })*/            }        }]        $('#album').treegrid({            url: '${pageContext.request.contextPath}/album/queryall',            idField: 'id',            treeField: 'title',            fit: true,            fitColumns: true,            onDblClickRow: function (row) {                $("#album_paly").dialog("open");                $("#audio").prop("src","http://localhost:9001/"+row.url);                $("#bkimg").prop("src", "http://localhost:9001/" + row.pic);            },            toolbar: toolbar,            columns: [[                {field: 'title', title: '名称', width: 65, align: 'center'},                {field: 'filesize', title: '大小(M)', width: 80, align: 'center'},                {                    field: 'uploadtime', title: '上传时间', width: 80, align: 'center', formatter: function (value) {                    var date = new Date(value);                    var y = date.getFullYear();                    var m = date.getMonth() + 1;                    var d = date.getDate();                    return y + '-' + m + '-' + d;                }                },                {field: 'path', title: '路径', width: 80, align: 'center'}            ]]        });        //添加章节表单初始化        $("#chapter_ff").form({            url:'${pageContext.request.contextPath}/music/insert',            iframe:false,            onSubmit: function(){                return $("#chapter_ff").form("validate");            },            success:function(data){                alert("添加章节成功");                $("#chapter_dialog").dialog("close");                $("#album").treegrid("reload");            }        })        //添加专辑表单初始化        $("#album_add_ff").form({            url:'${pageContext.request.contextPath}/album/insert',            iframe:false,            onSubmit: function(){                return $("#album_add_ff").form("validate");            },            success:function(data){                alert("添加专辑成功");                $("#album_add_dialog").dialog("close");                $("#album").treegrid("reload");            }        })    })</script><table id="album"></table><div id="album_dialog" class="easyui-dialog" title="专辑详情" style="width:480px;height:380px;"     data-options="iconCls:'icon-filter',resizable:true,modal:true,closed:true">    <form id="album_ff" method="post">        <br/>        <div>            <label for="name">名&nbsp;&nbsp;称:</label>            <input class="easyui-validatebox" id="name" type="text" name="title"/>            <label for="name">作&nbsp;&nbsp;者:</label>            <input class="easyui-validatebox" id="author" type="text" name="author"/>        </div><br/>        <div>            <label for="zhangjieshu">集&nbsp;&nbsp;数:</label>            <input class="easyui-validatebox" type="text" id="zhangjieshu" name="zhangjieshu"/>            <label for="boyinyuan">播音员:</label>            <input class="easyui-validatebox" type="text" id="boyinyuan" name="boyinyuan"/>        </div><br/>        <div>            <label for="jianjie">简&nbsp;&nbsp;介:</label>            <input class="easyui-textbox" type="text" id="jianjie" name="jianjie" style="height:100px;width: 400px"                   multiline="true"/>        </div><br/>        <div>            <label for="score">评&nbsp;&nbsp;分:</label>            <input class="easyui-validatebox" type="text" id="score" name="score"/>        </div><br/>        <div>            <label for="img">封&nbsp;&nbsp;面:</label>            <img id="img" src="" width="60px" height="80px">        </div>    </form></div><div id="album_add_dialog" class="easyui-dialog" title="添加专辑" style="width:480px;height:380px;"     data-options="iconCls:'icon-save',resizable:true,modal:true,closed:true,buttons:[{				text:'保存',				handler:function(){				$('#album_add_ff').submit();				}			},{				text:'关闭',				handler:function(){                    $('#album_add_dialog').dialog('close');				}			}]">    <form id="album_add_ff" method="post" enctype="multipart/form-data">        <br/>        <div>            <label for="name">名&nbsp;&nbsp;称:</label>            <input class="easyui-validatebox"  type="text" name="title"/>            <label for="name">作&nbsp;&nbsp;者:</label>            <input class="easyui-validatebox"  type="text" name="author"/>        </div><br/>        <div>            <label for="zhangjieshu">集&nbsp;&nbsp;数:</label>            <input class="easyui-validatebox" type="text"  name="zhangjieshu"/>            <label for="boyinyuan">播音员:</label>            <input class="easyui-validatebox" type="text"  name="boyinyuan"/>        </div><br/>        <div>            <label for="jianjie">简&nbsp;&nbsp;介:</label>            <input class="easyui-textbox" type="text"  name="jianjie" style="height:100px;width: 400px"                   multiline="true"/>        </div><br/>        <div>            <label for="score">评&nbsp;&nbsp;分:</label>            <input class="easyui-validatebox" type="text"  name="score"/>            <label for="jianjie">时&nbsp;&nbsp;间:</label>            <input class="easyui-datebox" name="uploadtime"/>        </div><br/>        <div>            <label for="file">图&nbsp;&nbsp;片:</label>            <input class="easyui-filebox" id="coverimage" name="img"/>        </div>    </form></div><div id="chapter_dialog" class="easyui-dialog" title="添加章节" style="width:260px;height:260px;"     data-options="iconCls:'icon-save',resizable:true,modal:true,closed:true,buttons:[{				text:'保存',				handler:function(){                    $('#chapter_ff').submit();                  }			},{				text:'关闭',				handler:function(){                    $('#chapter_dialog').dialog('close');				}			}]">    <form id="chapter_ff" method="post" enctype="multipart/form-data">        <br/>        <div style="display: none">            <label for="name">I&nbsp;&nbsp;&nbsp;&nbsp;D:</label>            <input class="easyui-textbox"  type="text" name="album_id" value="0" id="music_id"/>        </div><br/>        <div>            <label for="name">名&nbsp;&nbsp;称:</label>            <input class="easyui-validatebox"  type="text" name="title"/>        </div><br/>        <div>            <label for="zhangjieshu">大&nbsp;&nbsp;小:</label>            <input class="easyui-validatebox" type="text"  name="filesize"/>        </div><br/>        <div>            <label for="jianjie">时&nbsp;&nbsp;间:</label>            <input class="easyui-datebox" name="uploadtime"/>        </div><br/>        <div>            <label for="file">上&nbsp;&nbsp;传:</label>            <input class="easyui-filebox" name="musicfile"/>        </div>    </form></div><div id="album_paly" class="easyui-dialog" title="播放音频" style="width:350px;height:170px;"     data-options="iconCls:'icon-save',resizable:true,modal:true,closed:true">    <audio id="audio" src="" controls="controls" autoplay="autoplay"></audio>    <img id="bkimg" src="" width="60px" height="80px"></div>