package com.baizhi.controller;import com.baizhi.entity.Sowingmap;import com.baizhi.service.SowingmapService;import org.apache.commons.io.FilenameUtils;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.http.MediaType;import org.springframework.web.bind.annotation.PostMapping;import org.springframework.web.bind.annotation.RequestMapping;import org.springframework.web.bind.annotation.RestController;import org.springframework.web.multipart.MultipartFile;import javax.servlet.http.HttpServletRequest;import java.io.File;import java.io.IOException;import java.util.*;/** * Created by dell on 2018/5/29. */@RestController@RequestMapping(value = "/sowingmap")public class SowingmapController {    @Autowired    private SowingmapService sowingmapService;    @RequestMapping(value = "/deletes")    public void deletes(String[] ids){        for(int i=0;i<ids.length;i++) System.out.println(ids[i]);        List<String>list=new ArrayList<String>();        for (String id:ids) {            list.add(id);        }        sowingmapService.deletes(list);    }    @RequestMapping(value = "/update")    public void update(Sowingmap sowingmap){        sowingmapService.update(sowingmap);    }    @RequestMapping(value="/queryall",produces = {MediaType.APPLICATION_JSON_UTF8_VALUE})    public Map queryall(Integer page,Integer rows)throws Exception{        Map<String, Object> map=new HashMap<String, Object>();        List<Sowingmap> list=sowingmapService.queryall((page - 1) * rows, rows);        int count=sowingmapService.querySize();        map.put("total",count);        map.put("rows",list);        return map;    }    @PostMapping(value="/add")    public void addSM(MultipartFile img, Sowingmap sowingmap, boolean imagezt, HttpServletRequest request) throws IOException {        //获取当前项目路径        String projetPath = request.getSession().getServletContext().getRealPath("/");        File file = new File(projetPath);        //web项目的路径        String webappsPath = file.getParent();        //上传文件夹的路径        File uploadPath = new File(webappsPath + "/upload");        //创建上传文件夹        if (!uploadPath.exists()) {            uploadPath.mkdir();        }        //获取原始文件名  1.jpg        String oldFilename = img.getOriginalFilename();        //获取后缀名        String extension = FilenameUtils.getExtension(oldFilename);        UUID uuid = UUID.randomUUID();        String newName = uuid.toString();        newName = newName + "." + extension;        try {            //上传到指定的文件夹            img.transferTo(new File(uploadPath.getPath(), newName));        } catch (IOException e) {            e.printStackTrace();        }        //2将数据存储到数据库        if(imagezt) sowingmap.setImagestatus("y");        else sowingmap.setImagestatus("n");        String str = UUID.randomUUID().toString();        String id = str.replace("-", "");        sowingmap.setId(id);        sowingmap.setPath(newName);        sowingmap.setOldname(img.getOriginalFilename());        sowingmapService.insert(sowingmap);    }}