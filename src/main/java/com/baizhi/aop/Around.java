package com.baizhi.aop;import com.baizhi.annotation.LogAnnotation;import com.baizhi.daos.CmfzlogDao;import com.baizhi.entity.Cmfzlog;import com.baizhi.entity.Manager;import org.aopalliance.intercept.MethodInterceptor;import org.aopalliance.intercept.MethodInvocation;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.web.context.request.RequestContextHolder;import org.springframework.web.context.request.ServletRequestAttributes;import javax.servlet.http.HttpSession;import java.lang.reflect.Method;import java.util.Date;import java.util.UUID;/** * Created by dell on 2018/6/5. */public class Around implements MethodInterceptor {    @Autowired    private CmfzlogDao cmfzlogDao;    public CmfzlogDao getCmfzlogDao() {        return cmfzlogDao;    }    public void setCmfzlogDao(CmfzlogDao cmfzlogDao) {        this.cmfzlogDao = cmfzlogDao;    }    public Object invoke(MethodInvocation invocation) throws Throwable {        Cmfzlog cmfzlog =new Cmfzlog();        ServletRequestAttributes requestAttributes = (ServletRequestAttributes) RequestContextHolder.getRequestAttributes();        HttpSession session = requestAttributes.getRequest().getSession();        //人？        Manager manager = (Manager) session.getAttribute("manager");        String userid = manager.getId();        String username = manager.getName();        cmfzlog.setId(UUID.randomUUID().toString().replace("-",""));        cmfzlog.setUserid(userid);        cmfzlog.setUsername(username);        //时间？        Date date = new Date();        cmfzlog.setTimes(date);        //事？        Method method = invocation.getMethod();        LogAnnotation annotation = method.getAnnotation(LogAnnotation.class);        String methodname = annotation.name();        cmfzlog.setMethods(methodname);        //执行结果        boolean flag = false;        Object proceed = null;        //  原始方法执行之后的结果  返回值        try {            proceed = invocation.proceed();            flag = true;        } catch (Exception e) {            flag = false;        }        System.out.println("一次日志"+cmfzlog);        //存入DB        cmfzlogDao.insert(cmfzlog);        return proceed;    }}